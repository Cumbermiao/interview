- [参考文章](https://excess-xss.com/)
- [前端安全](https://juejin.im/post/5bad9140e51d450e935c6d64#heading-9)

# XSS

> XSS（Cross Site Script），全称跨站脚本攻击，为了与 CSS（Cascading Style Sheet） 有所区别，所以在安全领域称为 XSS。

XSS 分为三类： 反射型、存储型、DOM 型。

## 反射型

反射型 XSS 攻击步骤：

1. 攻击者构造出特殊的 URL，其中包含恶意代码， 并诱导用户访问。
2. 用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从 URL 中取出，拼接在 HTML 中返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

反射型 XSS 漏洞常见于通过 URL 传递参数的功能，如网站搜索、跳转等。
反射型 XSS 跟存储型 XSS 的区别是：存储型 XSS 的恶意代码存在数据库里，反射型 XSS 的恶意代码存在 URL 里。

## 存储型

存储型 XSS 的攻击步骤：

1. 攻击者将恶意代码提交到目标网站的数据库中。
2. 用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在 HTML 中返回给浏览器。
3. 用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。
4. 恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。

这种攻击常见于带有用户保存数据的网站功能，如论坛发帖、商品评论、用户私信等。

## DOM 型 

DOM 型 XSS 属于前端的漏洞， 前两种类型属于服务端漏洞。
DOM 型 XSS 一般是由于信任了用户的输入， 将用户恶意的输入使用 html 的方式插入到了页面中， 导致恶意代码被执行。

## XSS 预防

1. 应对 XSS 攻击的第一道防线是编码， 对于用户的输入进行转义， 但是该方法有一定局限性， 如果对于 `<a href="javascript:" />` 的情况无法防范。
2. 针对编码方法的缺点，我们还需要验证来防范一些恶意代码。验证用来对于用户的输入进行过滤。验证主要有两种实现：分类策略和验证结果。 分类策略分为白名单和黑名单，处于黑名单里面的属性或代码对于进行处理， 如在 href 中检测到了 `javascript:` 对其第一个字符进行编码。黑名单的缺点在于 html5 的属性更新较快， 无法防范新出的一些属性。相对而言，白名单就很简单，对于符合白名单的属性不进行处理，否则进行编码。 对于验证结果的实现来说， 判断用户的输入是否合法， 如果不合法对其进行删除或者直接拒绝。
3. CSP(Content Security Policy) 用来约束页面只能使用可信源下载的资源， 这意味即使攻击者成功的注入了恶意内容， CSP 也能够阻止恶意代码被执行。 CSP 常用的规则有： No untrusted sources 只能从可信源下载资源； No inline resources 行内 css、js 不会被执行； No eval js中禁止使用 eval；
4. 给 cookie 设置 http-only 防止页面 document.cookie 访问 cookie，即使 xss 注入成功也无法访问用户的敏感信息。